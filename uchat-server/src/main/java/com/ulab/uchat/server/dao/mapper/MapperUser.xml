<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ulab.uchat.server.dao.mapper.MapperUser">
    <select id="selectUserByEmail" parameterType="String" resultType="User">
        SELECT * FROM user WHERE email = #{email};
    </select>

    <select id="selectUserByLogin" parameterType="String" resultType="User">
        SELECT * FROM user WHERE email = #{login} OR id = #{login} OR identity = #{login};
    </select>
    
    <insert id="addUser" parameterType="User">
        INSERT INTO user (id, identity, first_name, last_name, email, phone, password, type) 
        VALUES (#{user.id}, #{user.identity}, #{user.firstName}, #{user.lastName}, #{user.email}, #{user.phone}, #{user.password}, #{user.type});
    </insert>

    <select id="selectPairedUsers" parameterType="String" resultType="java.util.List">
        SELECT u.* FROM user u, patient_doctor pd WHERE pd.user_id = #{user_id} AND u.id = pd.pair_user_id;
    </select>
    
    <insert id="addPatientDoctorRelation" parameterType="String">
        INSERT INTO patient_doctor (user_id, pair_user_id)
        VALUES (#{patientId}, #{doctorId}),
        	   (#{doctorId}, #{patientId});
    </insert>    
</mapper>